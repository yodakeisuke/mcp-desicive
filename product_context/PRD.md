# mcpâ€‘worktree â€” Product Requirements Document (Draft v0.1)

## 1. èƒŒæ™¯ / Context
ç”Ÿæˆ AI ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ™®åŠã«ã‚ˆã‚Šã€å˜ç‹¬é–‹ç™ºè€…ã§ã‚‚è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä¸¦åˆ—ç¨¼åƒã•ã›ã¦æ©Ÿèƒ½é–‹ç™ºã‚’è¡Œã†æ™‚ä»£ãŒåˆ°æ¥ã—ã¦ã„ã‚‹ã€‚ã—ã‹ã—ä½œæ¥­ãƒ©ã‚¤ãƒ³ãŒå¢—ãˆã‚‹ã»ã©ã€é€²æ—ã®å¯è¦–åŒ–ãƒ»è¡çªé˜²æ­¢ãƒ»çµ±åˆç®¡ç†ã¯äººé–“ã®èªçŸ¥é™ç•Œã‚’è¶…ãˆã‚„ã™ã„ã€‚
ã¾ãŸã€ä¸¦è¡Œç¨¼åƒã‚’æœ€å¤§åŒ–ã™ã‚‹ãŸã‚ã«ã¯ã€å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®é€²æ—ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŠŠæ¡ã—ã€æœ€é©ãªä¸¦åˆ—æ•°ã‚’å‹•çš„ã«èª¿æ•´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

## 2. ç›®çš„ / Goal
*è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹â€œåˆ†å²ãƒ»åˆæµã ã‚‰ã‘â€ã®é–‹ç™ºãƒ©ã‚¤ãƒ³ã‚’ã€äººã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒæ–¹ãŒä¸€æšã®åœ°å›³ã§æŠŠæ¡ãƒ»åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚*
*äººé–“ãƒ»PMâ€‘Agentã€ã¾ãŸã¯ãã‚Œãã‚Œã® Coding Agent ãŒç­–å®šã—ãŸã€éŒ¯ç¶œã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ©ãƒ³/å®Ÿè£…è¨ˆç”»ã‚’ç®¡ç†ã™ã‚‹*
*å‹•çš„ã«å¤‰åŒ–ã™ã‚‹é–‹ç™ºé€²æ—çŠ¶æ³ã«å¿œã˜ã¦ã€å¸¸ã«æœ€å¤§ã«Agentã‚’ä¸¦è¡Œç¨¼åƒã•ã›ã€æœ€é€Ÿã§ã®é–‹ç™ºå®Œäº†ã‚’ç›®æŒ‡ã™*

## 3. å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ / Target Users
* **ã²ã¨ã‚Šé–‹ç™ºè€…** ãŒãƒ­ãƒ¼ã‚«ãƒ«ã¾ãŸã¯ã‚¯ãƒ©ã‚¦ãƒ‰ã§è¤‡æ•°ã® AI ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ (Cursor, Claudeâ€‘Code, GPTâ€‘Dev ç­‰) ã‚’èµ°ã‚‰ã›ã‚‹ã‚±ãƒ¼ã‚¹
* å°è¦æ¨¡ãƒãƒ¼ãƒ ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ··åœ¨é–‹ç™ºã‚’è¡Œã† Tech Lead / PM Agent

## 4. å•é¡Œç‚¹ / Problem Statement
* ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã”ã¨ã« Git branch / worktree ãŒä¹±ç«‹ã—ã€ç¾çŠ¶æŠŠæ¡ã«æ™‚é–“ã‚’æµªè²»
* ãã®æ™‚ã€…ã§æœ€é©ãªä¸¦åˆ—ç¨¼åƒAgentæ•°ãŒã‚ã‹ã‚‰ãªã„ã€‚èª¿æ•´ã§ããªã„
* åŒä¸€æ©Ÿèƒ½ã®é‡è¤‡å®Ÿè£…ã‚„ãƒãƒ¼ã‚¸è¡çªã‚’äº‹å¾Œã«ç™ºè¦‹ã—ãŒã¡
* ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¯è¦–åŒ–å‡ºæ¥ãªã„ï¼ˆèª¿æŸ»ä¸­ãƒ»å®Ÿè£…ä¸­ãªã©ï¼‰

## 5. ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³æ¦‚è¦ / Solution Overview

`mcpâ€‘worktree` ã¯ **é€²æ—å…±æœ‰ãƒãƒ– (Multiâ€‘agent Control Point: MCP)** ã¨ã—ã¦æ©Ÿèƒ½ã—ã€ä»¥ä¸‹ã‚’æä¾›ã™ã‚‹ã€‚

1. **Central Progress Store**
   - å„ãƒ©ã‚¤ãƒ³ã®å®Œäº†/æ®‹ã‚¿ã‚¹ã‚¯, æ‰€æœ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ/ä½œæ¥­worktreeã‚’è¨˜éŒ²
   - äººé–“ãƒ»PMâ€‘Agentã€ã¾ãŸã¯ãã‚Œãã‚Œã® Coding Agent ãŒç­–å®šã—ãŸã€éŒ¯ç¶œã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ©ãƒ³/å®Ÿè£…è¨ˆç”»ã‚’ç®¡ç†å¯èƒ½
2. **Agent Sync TOOL**
   - Coding AgentãŒ mcp tool callã«ã‚ˆã‚‹ push/pull ã§ç›¸äº’çŠ¶æ³æŠŠæ¡
   - Coding AgentãŒ è‡ªå¾‹çš„ã«ãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ©ãƒ³/å®Ÿè£…è¨ˆç”»ã‚’å¤‰æ›´å¯èƒ½ 
3. **Tracking TOOL**
   - äººé–“ãƒ»PMâ€‘Agent ã‹ã‚‰ã®mcp tool callã§ãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§å…¨ä½“åƒã‚’ç¢ºèª
   - äººé–“ãƒ»PMâ€‘Agent ã‹ã‚‰ã®ã‚¿ã‚¹ã‚¯æ›´æ–°æŒ‡ç¤ºã‚’åæ˜ ã§ãã‚‹

## 6. MCP Tool å®šç¾©ï¼ˆæœ€å°ã‚³ã‚¢ï¼‰
**Model Context Protocol (MCP)** over stdioã€‚

### Tool ä¸€è¦§
ğŸ§  1. plan
ä¸»ãªåˆ©ç”¨è€…: PM-AgentãŒãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ã‚’ç­–å®šã€Coding AgentãŒæ–°è¦ãƒã‚±ãƒƒãƒˆã‚’è‡ªå¾‹çš„ã«èµ·ç¥¨
ç›®çš„: äº’ã„ã«ä¾å­˜ã®ç„¡ã„å¯èƒ½ä¸¦è¡Œé–‹ç™ºæ•°ã‚’æœ€å¤§ã«ã—ãŸã€PRå˜ä½ã§ã®ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ã®ä½œæˆã€ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã€‚å…¨ã‚¿ã‚¹ã‚¯å†å®šç¾©
ç¾å®Ÿã‚¢ãƒŠãƒ­ã‚¸ãƒ¼: æœ€çŸ­ãƒ‘ã‚¹ã«ãªã‚‹ã‚ˆã†ã«å…¨ä½“ã‚¿ã‚¹ã‚¯ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã€branchåˆ‡ã‚Šã€è¿½åŠ ãƒã‚±ãƒƒãƒˆã®èµ·ç¥¨
æ©Ÿèƒ½è¦ä»¶:
- ã‚¿ã‚¹ã‚¯è¨ˆç”»å…¨ä½“ã‚’writeã§ãã‚‹
- ä¸€æ‹¬ã§ãƒªãƒ—ãƒ©ãƒ³ã‚’writeã§ãã‚‹
  - ä¸€æ‹¬ãƒªãƒ—ãƒ©ãƒ³ã‚’ç”¨ã„ã¦ã€Coding AgentãŒè‡ªåˆ†ã®ã‚¿ã‚¹ã‚¯ã‚’èµ·ç¥¨ã§ãã‚‹ã“ã¨ã‚‚å«ã¾ã‚Œã‚‹

ğŸ‘¤ 2. assign
ä¸»ãªåˆ©ç”¨è€…: PM-AgentãŒCoding Agentã‚’ã‚¢ã‚µã‚¤ãƒ³ã€Coding AgentãŒã‚»ãƒ«ãƒ•ã‚¢ã‚µã‚¤ãƒ³
ç›®çš„: ä½œæ¥­ã‚„è²¬ä»»ã‚’ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‹
ç¾å®Ÿã‚¢ãƒŠãƒ­ã‚¸ãƒ¼: æ‹…å½“æ±ºå®šã€è²¬ä»»ã®ç§»è­²ã€ãƒ¡ãƒ³ãƒãƒ¼ã®å‚ç”»
æ©Ÿèƒ½è¦ä»¶:
- Coding AgentãŒ PrTask ã‚’è‡ªåˆ†ã«ã‚’ã‚¢ã‚µã‚¤ãƒ³ã§ãã‚‹
- æ‰‹ãŒç©ºã„ãŸAgentã¯ã€ç¾çŠ¶ã‚’ç¢ºèªã—ã€æ¬¡ã«è‡ªåˆ†ãŒè¡Œã†ã¹ãã‚¿ã‚¹ã‚¯ã‚’è‡ªå¾‹åˆ¤æ–­ã™ã‚‹

ğŸ“Š 3. track
ä¸»ãªåˆ©ç”¨è€…: PM-AgentãŒçŠ¶æ³ç¢ºèªã€Coding AgentãŒè‡ªåˆ†ãŠã‚ˆã³äº’ã„ã®çŠ¶æ³ã‚’æŠŠæ¡
ç›®çš„: çŠ¶æ³ã®æŠŠæ¡ã€ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã€ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒ–
ç¾å®Ÿã‚¢ãƒŠãƒ­ã‚¸ãƒ¼: ã‚¹ã‚¯ãƒ©ãƒ ãƒœãƒ¼ãƒ‰ã€é€²æ—ä¸€è¦§ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼æº–å‚™
æ©Ÿèƒ½è¦ä»¶: 
- ç¾åœ¨ã®planã®å…¨ä½“çŠ¶æ³ãŒreadã§ãã‚‹
- ç¾åœ¨ã®å¯èƒ½ä¸¦è¡Œæ•°ã¨ã€ç¨¼åƒCoding Agentæ•°ãŒreadã§ãã‚‹
- ãã‚Œãã‚Œã®ã‚¿ã‚¹ã‚¯ã®æ¦‚è¦ã‚„å‰å¾Œé–¢ä¿‚ã‚’çŸ¥ã‚‹ã“ã¨ã§ã€æ¬¡ã«è¡Œã†ã‚¿ã‚¹ã‚¯ã®ã‚»ãƒ«ãƒ•ã‚¢ã‚µã‚¤ãƒ³ã®ãŸã‚ã®æƒ…å ±ã‚’åé›†ã§ãã‚‹

ğŸ”„ 4. update
ä¸»ãªåˆ©ç”¨è€…: Coding AgentãŒè‡ªåˆ†ã®ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ã€PM-AgentãŒç›´æ¥è¨ˆç”»ã‚’å¾®ä¿®æ­£
ç›®çš„: PRã‚¿ã‚¹ã‚¯ãƒ»ãƒ©ã‚¤ãƒ³ã®çŠ¶æ…‹ã‚„ä¸­èº«ã‚’å¤‰æ›´ã€‚å˜ä¸€ã‚¿ã‚¹ã‚¯ï¼ãƒ©ã‚¤ãƒ³ç·¨é›†
ç¾å®Ÿã‚¢ãƒŠãƒ­ã‚¸ãƒ¼: ã‚«ãƒ³ãƒãƒ³ã®æ›´æ–°ã€ãƒã‚±ãƒƒãƒˆã®å®Œäº†
æ©Ÿèƒ½è¦ä»¶:
- ç‰¹å®šã®PRã‚¿ã‚¹ã‚¯ã‚’updateã§ãã‚‹

---

### 6.1 PRã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ enum
- ã‚¿ã‚¹ã‚¯ã®ç®¡ç†å˜ä½ã¯ã€**PRå˜ä½ã¨ã™ã‚‹**
- PR Taskã®çŠ¶æ…‹é·ç§»
  - Investigation â†’ InProgress â†’ Review â†’ Done ã¯ç›´ç·šçš„ã«é †å®ˆã•ã‚Œã‚‹ä¸»çµŒè·¯
  - Blocked ãŠã‚ˆã³ Abandoned ã¯ã€ä»»æ„ã®é€”ä¸­çŠ¶æ…‹ã‹ã‚‰åˆ†å²å¯èƒ½
  - Done ã‹ã‚‰ã¯é·ç§»ä¸å¯ï¼ˆçµ‚ç«¯ï¼‰
```mermaid
    stateDiagram-v2
    [*] --> Investigation

    Investigation --> InProgress
    InProgress --> Review
    Review --> Done
    Done --> [*]

    Investigation --> Blocked
    InProgress --> Blocked
    Review --> Blocked

    Investigation --> Abandoned
    InProgress --> Abandoned
    Review --> Abandoned
    Blocked --> Abandoned
```

### 6.2 ãƒ‡ãƒ¼ã‚¿æ¦‚è¦
- æƒ…å ±æ§‹é€ 
  - PrTask
  - Line
  - Agent
  - Assignment
- ãƒ‡ãƒ¼ã‚¿ãƒ“ãƒ¥ãƒ¼
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã®ãƒ“ãƒ¥ãƒ¼: json
  - ã‚³ãƒ¼ãƒ‰ä¸Šã®ãƒ¢ãƒ‡ãƒ«
  - æ°¸ç¶šåŒ–ãƒ¢ãƒ‡ãƒ«: json

## 7. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯æ¡ˆ / Tech Stack
* **API**: Model Context Protocol (ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•/stdio)
* **Backend**: Node.js + TypeScript
* **Database**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã«jsonã¨ã—ã¦ä¿å­˜
* **Frontend**: ç„¡ã—(mcp server ã¨ã—ã¦ã®ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ã‚µãƒ¼ãƒ“ã‚¹)

## 8. ç«¶åˆãƒ»ä»£æ›¿æ‰‹æ®µ / Alternatives
* ãƒªãƒã‚¸ãƒˆãƒªã®`.md` ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†
* Linear, Jira + Automation
* GitHub Issue