# Implementation Plan

- [x] 1. MCPツールの基本構造を作成する
  - src/mcp/tool/define-issue/ ディレクトリを作成
  - 基本的なファイル構造（schema.ts, handler.ts, index.ts）を設定
  - _Requirements: 4.1_

- [x] 2. 入力・出力スキーマを実装する
  - [x] 2.1 入力スキーマをZodで定義する
    - issue（1〜30文字）、context（1〜60文字）、constraints（1〜60文字）の検証ルールを実装
    - 適切なエラーメッセージを日本語で設定
    - _Requirements: 1.1, 1.2_
  
  - [x] 2.2 出力スキーマを定義する
    - 構造化出力用のissueフィールドのみを含むスキーマを作成
    - TypeScript型定義を生成
    - _Requirements: 3.1_

- [x] 3. ファイルシステム操作を実装する
  - [x] 3.1 データディレクトリ作成機能を実装する
    - ./data ディレクトリの存在確認と作成
    - 権限エラーのハンドリング
    - _Requirements: 2.1_
  
  - [x] 3.2 JSON保存機能を実装する
    - IssueDefinition構造でのJSONファイル保存
    - 上書き保存の動作確認
    - UTF-8エンコーディングの設定
    - _Requirements: 2.1, 2.2_

- [x] 4. ハンドラーロジックを実装する
  - [x] 4.1 入力検証処理を実装する
    - Zodスキーマによるバリデーション
    - エラーメッセージの日本語化
    - _Requirements: 1.1, 1.2_
  
  - [x] 4.2 課題定義保存処理を実装する
    - 検証済みデータのファイル保存
    - ファイルシステムエラーのハンドリング
    - _Requirements: 2.1, 2.2_
  
  - [x] 4.3 レスポンス生成処理を実装する
    - 成功時の構造化レスポンス（issueのみ）
    - 次のアクション指示メッセージの生成
    - エラー時の修正指示メッセージ
    - _Requirements: 3.1, 3.2_

- [x] 5. エラーハンドリングを実装する
  - [x] 5.1 バリデーションエラー処理を実装する
    - 文字数制限エラーの適切な処理
    - 必須フィールドエラーの処理
    - _Requirements: 1.2_
  
  - [x] 5.2 ファイルシステムエラー処理を実装する
    - ディレクトリ作成失敗の処理
    - ファイル書き込み失敗の処理
    - 権限エラーの処理
    - _Requirements: 2.1, 2.2_

- [x] 6. ツール登録とエクスポートを実装する
  - [x] 6.1 ツール定義を作成する
    - name, description, parameters, outputSchemaの設定
    - handlerの関連付け
    - _Requirements: 4.1_
  
  - [x] 6.2 MCPサーバーへの登録を実装する
    - Server.tsでのツール登録
    - 既存ツールとの統合確認
    - _Requirements: 4.1_

- [ ] 7. 単体テストを作成する
  - [ ] 7.1 正常系テストを実装する
    - 有効な入力での正常動作テスト
    - 上書き保存の動作テスト
    - 構造化レスポンスの検証
    - _Requirements: 1.1, 2.2, 3.1_
  
  - [ ] 7.2 異常系テストを実装する
    - バリデーションエラーのテスト
    - ファイルシステムエラーのテスト
    - エラーメッセージの検証
    - _Requirements: 1.2, 2.1, 3.2_

- [ ] 8. 統合テストを作成する
  - [ ] 8.1 MCPサーバー統合テストを実装する
    - ツール登録の確認
    - エンドツーエンドの動作テスト
    - _Requirements: 4.1_
  
  - [x] 8.2 ファイルシステム統合テストを実装する
    - 実際のファイル作成・上書きテスト
    - 権限エラーシナリオのテスト
    - _Requirements: 2.1, 2.2_